// cashmusic.js v6 | (c) 2016 CASH Music | http://cashmusic.github.io/cashmusic.js/ | https://github.com/cashmusic/cashmusic.js/blob/master/LICENSE
(function(){var f=window.cashmusic;f.measure.getClickPosition=function(a){var b=a.currentTarget?a.currentTarget:a.srcElement,c=f.measure.getPosition(b),e=a.clientX-c.x;return{x:e,y:a.clientY-c.y,percentage:e/b.clientWidth}};f.measure.getPosition=function(a){for(var b=0,c=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{x:b,y:c}};Array.prototype.indexOf||(Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;
return-1});var b;f.soundplayer={playlist:!1,playlists:{},sound:!1,lastTimeEvent:"0:00",styleDivs:null,tweenDivs:null,_init:function(){b=f.soundplayer;b.styleDivs=document.querySelectorAll("*.cashmusic.setstyles");b.tweenDivs=document.querySelectorAll("*.cashmusic.tween");var a=document.querySelectorAll("div.cashmusic.soundplayer.playlist"),d=a.length;if(0<d)for(var c=0;c<d;c++){var e=a[c],g=JSON.parse(e.getAttribute("data-playlist")),g=b._formatPlaylist(g,e.id,c);e.id=e.id?e.id:g.id;for(var h=document.querySelectorAll("#"+
e.id+' a[href$=".mp3"],#'+e.id+' a[href$=".MP3"],#'+e.id+' a[href$=".ogg"],#'+e.id+' a[href$=".OGG"],#'+e.id+' a[href$=".m4a"],#'+e.id+' a[href$=".M4A"],#'+e.id+' a[href$=".wav"],#'+e.id+' a[href$=".WAV"]'),n=h.length,k=0;k<n;k++){var p=h[k];g.tracks.push(b._formatTrack(p,g.id));p.parentNode.removeChild(p)}b.addPlaylist(g,!0);b.drawPlayer(e,g)}var e=document.querySelectorAll("*.cashmusic.soundplayer.playstop,a.cashmusic.soundplayer.inline"),d=e.length;if(0<d)for(f.styles.injectCSS('a.cashmusic.soundplayer.inline.stopped:after{content: " [\u25b8]";}a.cashmusic.soundplayer.inline.playing:after{content: " [\u25aa]";}'),
c=0;c<d;c++){var m=e[c];f.styles.addClass(m,"stopped");f.styles.hasClass(m,"playstop")?(a=m.getAttribute("data-soundid"),soundManager.getSoundById(a)||soundManager.createSound({id:a,url:a})):soundManager.createSound({id:m.href,url:m.href});f.events.add(m,"click",function(a){var d=f.styles.hasClass(m,"playstop")?soundManager.getSoundById(m.getAttribute("data-soundid")):soundManager.getSoundById(m.href);if(d)return b.toggle(d.id,!0),a.returnValue=!1,a.preventDefault&&a.preventDefault(),!1})}e=document.querySelectorAll("*.cashmusic.soundplayer.playpause");
d=e.length;if(0<d)for(c=0;c<d;c++)g=e[c],f.styles.addClass(g,"paused"),a=g.getAttribute("data-soundid"),g.getAttribute("data-playerid")?f.events.add(g,"click",function(a){b.togglePlaylist((a.currentTarget?a.currentTarget:a.srcElement).getAttribute("data-playerid"));a.returnValue=!1;a.preventDefault&&a.preventDefault();return!1}):(soundManager.getSoundById(a)||soundManager.createSound({id:a,url:a}),f.events.add(g,"click",function(a){b.toggle((a.currentTarget?a.currentTarget:a.srcElement).getAttribute("data-soundid"));
a.returnValue=!1;a.preventDefault&&a.preventDefault();return!1}))},pause:function(){b.sound&&b.sound.pause()},play:function(){b.sound&&b.sound.play()},resume:function(){b.sound&&b.sound.paused&&b.sound.resume()},seek:function(a,d){if(d){if(!b.playlist||d!==b.playlist.id)return!1;b.sound.setPosition(Math.floor(a*b.sound.duration))}},stop:function(){b.sound&&(b.pause(),b.sound.setPosition(0),b._doStop(b.sound.id))},toggle:function(a,d){var c=d?b.stop:b.pause;b.sound=b.sound?b.sound:soundManager.getSoundById(a);
b.sound.id!==a&&(c(),b.sound=soundManager.getSoundById(a));d&&!b.sound.paused&&0!=b.sound.playState?b.stop():b.sound.togglePause();b._updateTitle()},next:function(a,d){b.loadPlaylist(a);var c=!1,e=!1,f=b.playlist;f&&(f.current<f.tracks.length?(c=parseInt(f.current)+1,e=!0):(c=1,d&&(e=!0)),f.current=c);e&&b.playlistPlayTrack(f.id,c)},previous:function(a){a||(a=b.playlist.id);b.loadPlaylist(a);var d=b.playlist;d&&(a=1<d.current?parseInt(d.current)-1:d.tracks.length,d.current=a,b.playlistPlayTrack(d.id,
a))},togglePlaylist:function(a){b.loadPlaylist(a);b.toggle(b.playlist.tracks[b.playlist.current-1].id)},playlistPlayTrack:function(a,d){b.loadPlaylist(a);b.stop();b.playlist.current=d;b.toggle(b.playlist.tracks[d-1].id)},addPlaylist:function(a,d){d||(a=b._formatPlaylist(a));for(var c=a.tracks.length,e=0;e<c;e++)a._index.push(a.tracks[e].id),soundManager.createSound({id:a.tracks[e].id,url:a.tracks[e].url});b.playlists[a.id]=a},loadPlaylist:function(a){b.sound&&b.playlist&&b.playlist.id!=a&&b.pause();
b.sound&&!b.playlist&&b.stop();b.playlist=b.playlists[a]},drawPlayer:function(a,d){"object"!=typeof d&&(d=b.playlists[d]);"object"==typeof d&&f.getTemplate("soundplayer",function(c){c=c.replace(/data-playerid=\"/g,'data-playerid="'+d.id);c=c.replace(/onPlayer\":\"/g,'onPlayer":"'+d.id);a.innerHTML=c;a.style.visibility="visible";a.style.display="block";a.style.position="relative";c="<ol>";for(var e=d.tracks.length,g=0;g<e;g++)c+='<li class="cashmusic soundplayer changetrack" data-track="'+(g+1)+'">'+
d.tracks[g].title+"</li>";c+="</ol>";e=document.querySelectorAll("#"+a.id+" div.cashmusic.soundplayer.playlist.tracklist");"undefined"!==e[0]&&(e[0].innerHTML=c);g=document.querySelectorAll("#"+a.id+" div.cashmusic.soundplayer.playlist.nowplaying, #"+a.id+" div.cashmusic.soundplayer.playlist.playtime, #"+a.id+" div.cashmusic.soundplayer.playlist.toggletracklist");c=g.length;for(e=0;e<c;e++)g[e].innerHTML=g[e].getAttribute("data-content")+"";g=document.querySelectorAll("#"+a.id+" div.cashmusic.soundplayer.playlist.controls *, #"+
a.id+" div.cashmusic.soundplayer.playlist.toggletracklist, #"+a.id+" li.cashmusic.soundplayer.changetrack");c=g.length;for(e=0;e<c;e++){var h=g[e];f.styles.hasClass(h,"playpause")&&(f.styles.addClass(h,"paused"),f.events.add(h,"click",function(a){b.togglePlaylist(d.id)}));f.styles.hasClass(h,"nexttrack")&&f.events.add(h,"click",function(a){b.next(d.id,!0)});f.styles.hasClass(h,"prevtrack")&&f.events.add(h,"click",function(a){b.previous(d.id)});f.styles.hasClass(h,"toggletracklist")&&f.events.add(h,
"click",function(b){b=document.querySelectorAll("#"+a.id+" div.cashmusic.soundplayer.playlist.tracklist")[0].style;"undefined"!==b&&(b.height="auto"!==b.height?"auto":"1px");h.blur()});f.styles.hasClass(h,"changetrack")&&f.events.add(h,"click",function(a){a=(a.currentTarget?a.currentTarget:a.srcElement).getAttribute("data-track");b.playlistPlayTrack(d.id,a)})}g=document.querySelectorAll("#"+a.id+" div.cashmusic.soundplayer.playlist.seekbar");c=g.length;for(e=0;e<c;e++)f.events.add(g[e],"click",function(a){b.seek(f.measure.getClickPosition(a).percentage,
d.id)})})},_doFinish:function(a){b._switchStylesForCollection(document.querySelectorAll("*.cashmusic.playpause"),"playing","paused");b._updateStyles(b.styleDivs,"finish");b.next(b.playlist.id);f.events.fire(f,"soundplayerFinish",{soundId:b.sound.id})},_doLoad:function(a){b._updateStyles(b.styleDivs,"load");f.events.fire(f,"soundplayerLoad",{soundId:b.sound.id})},_doLoading:function(a){b._updateTweens(b.tweenDivs,"load",a.percentage,a.duration);f.events.fire(f,"soundplayerLoading",{soundId:b.sound.id,
percentage:a.percentage,duration:a.duration})},_doPause:function(a){b._switchStylesForCollection(document.querySelectorAll("*.cashmusic.playpause"),"playing","paused");b._updateStyles(b.styleDivs,"pause");f.events.fire(f,"soundplayerPause",{soundId:b.sound.id})},_doPlay:function(a){b._doResume(a);f.events.fire(f,"soundplayerPlay",{soundId:b.sound.id})},_doPlaying:function(a){b._updateTweens(b.tweenDivs,"play",a.percentage,a.duration);b._updateTimes(a.position);var d=b._getTimecode(a.position);d!=
b.lastTimeEvent&&(b.lastTimeEvent=d,b._updateStyles(b.styleDivs,d));f.events.fire(f,"soundplayerPlaying",{soundId:b.sound.id,percentage:a.percentage,position:a.position,duration:a.duration,timecode:d})},_doResume:function(a){b.styleDivs=document.querySelectorAll("*.cashmusic.setstyles");b.tweenDivs=document.querySelectorAll("*.cashmusic.tween");a=document.querySelectorAll('a.cashmusic.soundplayer.inline[href="'+b.sound.id+'"]');for(var d=a.length,c=0;c<d;c++)f.styles.swapClasses(a[c],"stopped","playing");
b._switchStylesForCollection(document.querySelectorAll("*.cashmusic.playpause"),"paused","playing");0<b.sound.position?b._updateStyles(b.styleDivs,"play"):b._updateStyles(b.styleDivs,"resume");f.events.fire(f,"soundplayerResume",{soundId:b.sound.id})},_doStop:function(a){a=document.querySelectorAll('a.cashmusic.soundplayer.inline[href="'+a+'"]');for(var d=a.length,c=0;c<d;c++)f.styles.swapClasses(a[c],"playing","stopped");b._updateStyles(b.styleDivs,"stop");f.events.fire(f,"soundplayerStop",{soundId:b.sound.id})},
_checkIds:function(a,d){var c="",e="";"undefined"!==typeof d.onSound&&(c=d.onSound);"undefined"!==typeof d.onPlayer&&(e=d.onPlayer);return c&&-1===a.indexOf(c)||e&&!b._inPlaylist(e,a)?!1:!0},_getMS:function(a){a=a.split(":");var b=0,c=a.length;a.reverse();for(var e=0;e<c;e++)b+=parseInt(a[e])*(0==e?1:60*(1<e?60:1))*1E3;return b},_getTimecode:function(a){var b=Math.floor(a/1E3);a=Math.floor(b/3600);var c=0<a?("00"+Math.floor((b-3600*a)/60)).substr(-2):Math.floor(b/60),b=("00"+(b-3600*a-60*c)).substr(-2);
return 0<a?a+":"+c+":"+b:c+":"+b},_checkIdsForElement:function(a,d){var c={};c.onSound=d.getAttribute("data-soundid");c.onPlayer=d.getAttribute("data-playerid");return b._checkIds(a,c)},_updateTweens:function(a,d,c,e){for(var f=a.length,h=0;h<f;h++){var n=a[h],k=n.getAttribute("data-tween");if((k=JSON.parse(k))&&"undefined"!==typeof k[d])for(var p=k[d].length,m,l,q=0;q<p;q++)l=k[d][q],b._checkIds(b.sound.id,l)&&(-1!==(l.startAt+"").indexOf(":")&&(l.startAt=Math.round(b._getMS(l.startAt)/e*1E4)/100),
-1!==(l.endAt+"").indexOf(":")&&(l.endAt=Math.round(b._getMS(l.endAt)/e*1E4)/100),c>=l.startAt&&c<=l.endAt&&(m=l.startVal+(l.endVal-l.startVal)/(l.endAt-l.startAt)*(c-l.startAt),m="px"==l.units?Math.floor(m):m.toFixed(2),n.style[l.name]=m+l.units))}},_updateStyles:function(a,d){for(var c=a.length,e=0;e<c;e++){var f=a[e],h=f.getAttribute("data-styles");if((h=JSON.parse(h))&&"undefined"!==typeof h[d])for(var n=h[d].length,k=0;k<n;k++)b._checkIds(b.sound.id,h[d][k])&&("undefined"===typeof h[d][k].delay?
f.style[h[d][k].name]=h[d][k].val:function(a,b,c,d){setTimeout(function(){a.style[b]=c},d)}(f,h[d][k].name,h[d][k].val,h[d][k].delay))}},_switchStylesForCollection:function(a,d,c){for(var e=a.length,g=0;g<e;g++)b._checkIdsForElement(b.sound.id,a[g])&&!f.styles.hasClass(b.sound.id,a[g],"inline")&&f.styles.swapClasses(a[g],d,c)},_updateTimes:function(a){for(var d=document.querySelectorAll("div.cashmusic.soundplayer.playtime"),c=d.length,e=0;e<c;e++)b._checkIdsForElement(b.sound.id,d[e])&&(d[e].innerHTML=
b._getTimecode(a))},_updateTitle:function(){for(var a=document.querySelectorAll("div.cashmusic.soundplayer.nowplaying"),d=a.length,c=0;c<d;c++)b._checkIdsForElement(b.sound.id,a[c])&&(a[c].innerHTML=b.playlist.tracks[b.playlist.current-1].title)},_formatPlaylist:function(a,b,c){a=a?a:{};a.id||(a.id=b?b:"pl---"+c);a.current=1;a.tracks=a.tracks?a.tracks:[];a._index=[];return a},_formatTrack:function(a,b){var c=JSON.parse(a.getAttribute("data-track")),c=c?c:{};c.url=c.url?c.url:a.href;c.title=c.title?
c.title:a.innerText||a.textContent;c.id=b+c.url;return c},_inPlaylist:function(a,d){return a?-1<b.playlists[a]._index.indexOf(d)?!0:!1:!1}};window.SM2_DEFER=!0;f.loadScript(f.path+"/lib/soundmanager/soundmanager2.js",function(){b=f.soundplayer;window.soundManager=new SoundManager;soundManager.setup({debugMode:!1,debugFlash:!1,preferFlash:!1,allowScriptAccess:"always",url:f.path+"/lib/soundmanager/swf/",flashVersion:8,flashLoadTimeout:7500,flashPollingInterval:30,html5PollingInterval:30,useHighPerformance:!0,
onready:function(){b._init()},defaultOptions:{onload:function(){b._doLoad({id:this.id})},onstop:function(){b._doStop({id:this.id})},onfinish:function(){b._doFinish({id:this.id})},onpause:function(){b._doPause({id:this.id})},onplay:function(){b._doPlay({id:this.id})},onresume:function(){b._doResume({id:this.id})},stream:!0,usePolicyFile:!1,volume:100,whileloading:function(){b._doLoading({id:this.id,loaded:this.bytesLoaded,total:this.bytesTotal,percentage:Math.round(this.bytesLoaded/this.bytesTotal*
1E3)/10})},whileplaying:function(){b._doPlaying({id:this.id,position:this.position,duration:this.duration,percentage:Math.round(this.position/this.duration*1E4)/100})}}});soundManager.beginDelayedInit()})})();
