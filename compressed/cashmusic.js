// cashmusic.js v4 | (c) 2015 CASH Music | http://cashmusic.github.io/cashmusic.js/ | https://github.com/cashmusic/cashmusic.js/blob/master/LICENSE
window.cashmusic=function(){var h;null!=window.cashmusic?h=window.cashmusic:(h={embeds:{whitelist:"",all:[]},get:{},loaded:!1,soundplayer:!1,lightbox:!1,options:"",path:"",templates:{},eventlist:{},storage:{},embedded:!1,geo:!1,_init:function(){var a=window.cashmusic;a.scriptElement=document.querySelector('script[src$="cashmusic.js"]');a.scriptElement&&(a.path=a.scriptElement.src.substr(0,a.scriptElement.src.length-12));a.options=String(a.scriptElement.getAttribute("data-options"));-1!==this.options.indexOf("lightboxvideo")&&
a.loadScript(a.path+"lightbox/lightbox.js");0<document.querySelectorAll("a.cashmusic.soundplayer,div.cashmusic.soundplayer").length&&a.loadScript(a.path+"soundplayer/soundplayer.js");self!==top&&a._initEmbed();a.events.add(window,"message",function(b){-1!==a.embeds.whitelist.indexOf(b.origin)&&a._handleMessage(b)});a.embeds.whitelist+=window.location.href.split("/").slice(0,3).join("/");if(window.location.search){a.get.qs=window.location.search.substring(1);a.get.params={};for(var c,b=a.get.qs.split("&"),
d=0;d<b.length;d++)c=b[d].split("="),a.get.params[c[0]]=c[1]}if(a.embedded)a.loaded=Date.now(),a._drawQueuedEmbeds(),a.events.fire(a,"ready",a.loaded);else{a.get.qs&&-1!==a.get.qs.indexOf("element_id")&&window.history&&history.pushState&&history.pushState(null,null,window.location.href.split("?")[0]);-1===this.options.indexOf("nowrap")&&a.overlay.create();var e=0,d=setInterval(function(){25>e&&!a.geo?e++:(a.loaded=Date.now(),a._drawQueuedEmbeds(),clearInterval(d),a.events.fire(a,"ready",a.loaded))},
100)}},_drawQueuedEmbeds:function(){var a=window.cashmusic;"object"==typeof a.storage.elementQueue&&a.storage.elementQueue.forEach(function(c){a.embed(c[0],c[1],c[2],c[3],c[4],c[5])})},_initEmbed:function(){var a=window.cashmusic;a.embedded=!0;var c=document.querySelector("div.cashmusic.element");c&&(a.storage.embedheight=a.measure.scrollheight(),a.events.fire(a,"resize",a.storage.embedheight),c=c.className.split(" "),a.events.fire(a,"identify",[c[2],c[3].substr(3)]),window.setInterval(function(){var b=
a.measure.scrollheight();b!=a.storage.embedheight&&(a.storage.embedheight=b,a.events.fire(a,"resize",b))},250),(c=a.getQueryVariable("cssoverride"))&&a.styles.injectCSS(c,!0));for(var c=document.getElementsByTagName("form"),b=0;b<c.length;b++){var d=document.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name","embedded_element");d.setAttribute("value","1");c[b].appendChild(d)}},_handleMessage:function(a){for(var c=window.cashmusic,b=JSON.parse(a.data),d,e=0;e<c.embeds.all.length;e++)if(c.embeds.all[e].el.contentWindow===
a.source){d=c.embeds.all[e];break}e=b.data;switch(b.type){case "resize":d.el.height=e;d.el.style.height=e+"px";break;case "identify":d.id==e[1]&&(d.type=e[0]);break;case "stripetokenrequested":c.stripe.generateToken(e,a.source);break;case "stripetoken":c.events.fire(c,"stripetokengenerated",e);break;case "overlayreveal":c.overlay.reveal(e.innerContent,e.wrapClass);c.events.fire(c,"overlayopened","");break;case "addoverlaytrigger":c.overlay.addOverlayTrigger(e.content,e.classname,e.ref);break;case "injectcss":c.styles.injectCSS(e.css,
e.important);break;case "addclass":c.styles.addClass(e.el,e.classname);break;case "removeclass":c.styles.removeClass(e.el,e.classname);break;case "swapclasses":c.styles.swapClasses(e.el,e.oldclass,e.newclass)}},contentLoaded:function(a){var c=!1,b=!0,d=window.document,e=d.documentElement,f=function(b){if("readystatechange"!=b.type||"complete"==d.readyState)h.events.remove("load"==b.type?window:d,b.type,f),!c&&(c=!0)&&a.call(window,b.type||b)},g=function(){try{e.doScroll("left")}catch(a){setTimeout(g,
50);return}f("poll")};if("complete"==d.readyState)a.call(window,"lazy");else{if(d.createEventObject&&e.doScroll){try{b=!window.frameElement}catch(n){}b&&g()}this.events.add(d,"DOMContentLoaded",f);this.events.add(d,"readystatechange",f);this.events.add(d,"load",f)}},embed:function(a,c,b,d,e,f){var g=window.cashmusic;if(!e)var h=document.querySelectorAll("script"),k=h[h.length-1];if(g.loaded){"object"===typeof a&&(c=a.elementid?a.elementid:!1,b=a.lightboxed?a.lightboxed:!1,d=a.lightboxtxt?a.lightboxtxt:
!1,e=a.targetnode?a.targetnode:!1,f=a.cssoverride?a.cssoverride:!1,a=a.endpoint);var k="string"===typeof e?document.querySelector(e):e,m=g.buildEmbedIframe(a,c,f);if(k)if(b){var l=document.createElement("span");l.className="cashmusic embed link";d||(d="open element");g.overlay.create(function(){var a=document.createElement("a");a.href="";a.target="_blank";a.innerHTML=d;l.appendChild(a);k.parentNode.insertBefore(l,k);(function(){g.events.add(a,"click",function(a){g.overlay.reveal(m);a.preventDefault();
return!1})})()})}else k.parentNode.insertBefore(m,k)}else"object"!==typeof g.storage.elementQueue&&(g.storage.elementQueue=[]),"object"===typeof a?a.targetnode||(a.targetnode=k,arguments[0]=a):arguments[4]=k,g.storage.elementQueue.push(arguments)},buildEmbedIframe:function(a,c,b,d){var e=window.cashmusic;a=a.replace(/\/$/,"")+"/request/embed/"+c+"?location="+encodeURIComponent(window.location.href);e.geo&&(a+="&geo="+encodeURIComponent(e.geo));b&&(a+="&cssoverride="+encodeURIComponent(b));d&&(a+=
"&"+d);e.get.params&&e.get.params.element_id==c&&(a+="&"+e.get.qs);b=document.createElement("iframe");b.src=a;b.className="cashmusic embed";b.style.width="100%";b.style.height="0";b.style.border="0";b.style.overflow="hidden";b.scrolling="no";d=a.split("/").slice(0,3).join("/");-1===e.embeds.whitelist.indexOf(d)&&(e.embeds.whitelist+=d);e.embeds.all.push({el:b,id:c,type:""});return b},getTemplate:function(a,c){var b=window.cashmusic,d=b.templates;void 0!==d[a]?c(d[a]):(this.ajax.jsonp(b.path+"templates/"+
a+".js","callback",function(b){d[a]=b.template;c(b.template)},"cashmusic"+a+"Callback"),document.querySelectorAll('link[href="'+b.path+"templates/"+a+'.css"]').length||b.styles.injectCSS(b.path+"templates/"+a+".css"))},addEventListener:function(a,c){var b=window.cashmusic;b.eventlist.hasOwnProperty(a)||(b.eventlist[a]=[]);b.eventlist[a].push(c)},removeEventListener:function(a,c){var b=window.cashmusic;if(b.eventlist.hasOwnProperty(a)){var d=b.eventlist[a].indexOf(c);-1!=d&&b.eventlist[a].splice(d,
1)}},dispatchEvent:function(a){var c=window.cashmusic;if(c.eventlist.hasOwnProperty(a.type)){var b;for(b=0;b<c.eventlist[a.type].length;b++)if(c.eventlist[a.type][b])c.eventlist[a.type][b](a)}},loadScript:function(a,c){if(0<document.querySelectorAll('a[src="'+a+'"]').length)"function"===typeof c&&c();else{var b=document.getElementsByTagName("head")[0]||document.documentElement,d=document.createElement("script");d.src=a;var e=!1;d.onload=d.onreadystatechange=function(){e||this.readyState&&"loaded"!==
this.readyState&&"complete"!==this.readyState||(e=!0,"function"===typeof c&&c(),d.onload=d.onreadystatechange=null,b&&d.parentNode&&b.removeChild(d))};b.insertBefore(d,b.firstChild)}},getQueryVariable:function(a){for(var c=window.location.search.substring(1).split("&"),b=0;b<c.length;b++){var d=c[b].split("=");if(d[0]==a)return decodeURIComponent(d[1])}return!1},ajax:{getXHR:function(){try{return new XMLHttpRequest}catch(a){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(b){return!1}}}},
send:function(a,c,b,d){var e="POST";c||(e="GET",c=null);var f=this.getXHR();f&&(f.open(e,a,!0),f.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"==e&&f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),"function"==typeof b&&(f.onreadystatechange=function(){4===f.readyState&&(200===f.status?b(f.responseText):"function"===typeof d&&d(f.responseText))}),f.send(c))},jsonp:function(a,c,b,d){a=a||"";c=c||"";b=b||function(){};d=d||!1;"function"==typeof c&&(b=c,c="callback");
if(d){var e=d,f=function(){};"function"==typeof window[e]&&(f=window[e])}else e="jsonp"+Math.round(1000001*Math.random());window[e]=function(a){b(a);d?f(a):delete window[e]};a=-1===a.indexOf("?")?a+"?":a+"&";var g=document.createElement("script");g.setAttribute("src",a+c+"="+e);document.getElementsByTagName("head")[0].appendChild(g)},encodeForm:function(a){if("object"!==typeof a)return!1;var c="";a=a.elements||a;for(var b=0;b<a.length;b++)"checkbox"===a[b].type||"radio"===a[b].type?a[b].checked&&
(c+=(c.length?"&":"")+a[b].name+"="+a[b].value):c+=(c.length?"&":"")+a[b].name+"="+a[b].value;return encodeURI(c)},getHeaderForURL:function(a,c,b){a=this.getXHR();a.open("HEAD","https://javascript-cashmusic.netdna-ssl.com/cashmusic.js");a.onreadystatechange=function(){this.readyState==this.DONE&&b(this.getResponseHeader(c))};a.send()}},events:{add:function(a,c,b){a.attachEvent?(a["e"+c+b]=b,a[c+b]=function(){a["e"+c+b](window.event)},a.attachEvent("on"+c,a[c+b])):a.addEventListener(c,b,!1)},remove:function(a,
c,b){a.detachEvent?(a.detachEvent("on"+c,a[c+b]),a[c+b]=null):a.removeEventListener(c,b,!1)},fire:function(a,c,b){var d=window.cashmusic;if(document.dispatchEvent){var e=document.createEvent("CustomEvent");e.initCustomEvent(c,!1,!1,b);a.dispatchEvent(e)}else e=document.createEventObject(),e.detail=b,a.fireEvent("on"+c,e);d.embedded&&d.events.relay(c,b)},relay:function(a,c){window.parent.postMessage(JSON.stringify({type:a,data:c}),"*")}},measure:{viewport:function(){return{x:window.innerWidth||document.body.offsetWidth||
0,y:window.innerHeight||document.body.offsetHeight||0}},scrollheight:function(){var a=document.body,c=document.documentElement;return Math.max(a.scrollHeight,c.scrollHeight,a.offsetHeight,c.offsetHeight,a.clientHeight,c.clientHeight)}},overlay:{bg:!1,wrapper:!1,content:!1,close:!1,callbacks:[],create:function(a){var c=window.cashmusic,b=c.overlay;if(!1===b.wrapper){c.styles.injectCSS(c.path+"templates/overlay.css");b.wrapper=document.createElement("div");b.wrapper.className="cm-wrapper";b.bg=document.createElement("div");
b.bg.className="cm-bg";var d=window.getComputedStyle(document.body);b.bg.style.backgroundImage=d.getPropertyValue("background-image");b.bg.style.backgroundPosition=d.getPropertyValue("background-position");b.bg.style.backgroundSize=d.getPropertyValue("background-size");b.bg.style.backgroundRepeat=d.getPropertyValue("background-repeat");b.bg.style.backgroundOrigin=d.getPropertyValue("background-origin");b.bg.style.backgroundClip=d.getPropertyValue("background-clip");b.bg.style.backgroundAttachment=
d.getPropertyValue("background-attachment");for(b.bg.style.backgroundColor=d.getPropertyValue("background-color");document.body.childNodes.length;)b.wrapper.appendChild(document.body.childNodes[0]);document.body.appendChild(b.wrapper);b.content=document.createElement("div");b.content.className="cm-overlay";b.close=document.createElement("div");b.close.className="cm-close";c.events.add(window,"keyup",function(a){27==a.keyCode&&b.content.parentNode==document.body&&b.hide()});c.events.add(b.close,"click",
function(a){b.content.parentNode==document.body&&b.hide()})}"function"===typeof a&&a()},hide:function(){var a=window.cashmusic,c=a.overlay,b=document.body;a.events.fire(a,"overlayclosed","");c.wrapper.className="cm-wrapper";c.bg.className="cm-bg";for(setTimeout(function(){b.removeChild(c.bg)},1E3);c.content.firstChild;)c.content.removeChild(c.content.firstChild);b.removeChild(c.close);b.removeChild(c.content);b.style.overflow="auto"},reveal:function(a,c){var b=window.cashmusic,d=b.overlay,e=document.body;
if(b.embedded)b.events.fire(b,"overlayreveal",{innerContent:a,wrapClass:c});else{var f=document.createElement("div");f.className="cm-position";var g=document.createElement("div");g.className=c?c:"cm-element";"string"===typeof a?g.innerHTML=a:g.appendChild(a);f.appendChild(g);d.content.appendChild(f);e.style.overflow="hidden";d.wrapper.className="cm-wrapper cm-active";d.content.style.opacity=0;d.bg.style.height=b.measure.scrollheight()+"px";e.appendChild(d.bg);d.bg.className="cm-bg cm-active";e.appendChild(d.content);
e.appendChild(d.close);window.getComputedStyle(d.content).opacity;d.content.style.opacity=1}},addOverlayTrigger:function(a,c,b){var d=window.cashmusic,e=d.overlay;if(d.embedded)d.events.fire(d,"addoverlaytrigger",{content:a,classname:c,ref:b});else{var f=document.createElement("div");f.className=c;d.events.add(f,"click",function(b){if("string"===typeof a)d.overlay.reveal(a);else if(a.endpoint){var c=d.buildEmbedIframe(a.endpoint,a.element,!1,"&state="+a.state);d.overlay.reveal(c)}b.preventDefault();
return!1});e.wrapper.appendChild(f);d.storage[b]=f;d.events.fire(d,"triggeradded",b)}}},styles:{resolveElement:function(a){return"string"===typeof a?"storage:"==a.substr(0,8)?window.cashmusic.storage[a.substr(8)]:document.querySelector(a):a},addClass:function(a,c,b){var d=window.cashmusic;if(b&&d.embedded)d.events.fire(d,"addclass",{el:a,classname:c});else if(a=d.styles.resolveElement(a))a.className=a.className+" "+c},hasClass:function(a,c){return-1<(" "+a.className+" ").indexOf(" "+c+" ")},injectCSS:function(a,
c,b){var d=window.cashmusic;b&&d.embedded?d.events.fire(d,"injectcss",{css:a,important:c}):(b=document.getElementsByTagName("head")[0]||document.documentElement,"http"==a.substr(0,4)?(d=document.createElement("link"),d.rel="stylesheet",d.href=a):(d=document.createElement("style"),d.innerHTML=a),d.type="text/css",c?b.appendChild(d):b.insertBefore(d,b.firstChild))},removeClass:function(a,c,b){var d=window.cashmusic;if(b&&d.embedded)d.events.fire(d,"removeclass",{el:a,classname:c});else if(a=d.styles.resolveElement(a))a.className=
(" "+a.className+" ").replace(" "+c+" ","").replace(/^\s+/,"").replace(/\s+$/,"")},swapClasses:function(a,c,b,d){var e=window.cashmusic;if(d&&e.embedded)e.events.fire(e,"swapclasses",{el:a,oldclass:c,newclass:b});else if(a=e.styles.resolveElement(a))a.className=(" "+a.className+" ").replace(" "+c+" "," "+b+" ").replace(/^\s+/,"").replace(/\s+$/,"")}},stripe:{generateToken:function(a,c){var b=window.cashmusic;b.embedded?b.events.fire(b,"stripetokenrequested",a):b.loadScript("https://checkout.stripe.com/checkout.js",
function(){StripeCheckout.configure({key:a.key,image:a.image,token:function(a){c?c.postMessage(JSON.stringify({type:"stripetoken",data:a}),"*"):b.events.fire(b,"stripetokengenerated",a)}}).open({name:a.name,description:a.description,amount:a.amount,currency:a.currency,bitcoin:a.bitcoin})})}}},h.ajax.getHeaderForURL("https://javascript-cashmusic.netdna-ssl.com/cashmusic.js","GeoIp-Data",function(a){h.geo=a}),h.contentLoaded(function(){h._init(h)}));return h}();
